name: CI Build
  
on: 
    push:
      branches-ignore: ["release"]
    pull_request:

env:
    LC_ALL:       en_US.UTF-8
    GRADLE_OPTS: -Dorg.gradle.parallel=false

jobs:
    build:
        name:     build on OpenJDK JDK
        runs-on:  ubuntu-latest
        steps:
        -   name: Git Checkout
            uses: actions/checkout@v1
        -   name: Gradle Wrapper Validation
            uses: gradle/wrapper-validation-action@v1
        -   name: Set up Java
            uses: actions/setup-java@v1
            with: 
                java-version: 1.8
                java-package: jdk+fx
        -   name: Build Workspace
            run : ./gradlew build
        -   name: Build Executable JAR
            run : ./gradlew :in.bytehue.osgifx.console.product:export.osgifx
        -   name: Copy Executable JAR to Product Root Directory
            run : cp in.bytehue.osgifx.console.product/target/distributions/executable/osgifx.jar in.bytehue.osgifx.console.product/
        -   name: Change Working Directory to Product Root
            run : cd in.bytehue.osgifx.console.product
        -   name: Build MacOSX Image (DMG)
            run : javapackager -deploy -native dmg -srcfiles osgifx.jar -appclass aQute.launcher.pre.EmbeddedLauncher -name "OSGi.fx Console" -outdir deploy -outfile osgi-fx-console -v
        -   name: Build MacOSX Image (PKG)
            run : javapackager -deploy -native pkg -srcfiles osgifx.jar -appclass aQute.launcher.pre.EmbeddedLauncher -name "OSGi.fx Console" -outdir deploy -outfile osgi-fx-console -v
        -   name: Build Linux Image (RPM)
            run : javapackager -deploy -native rpm -srcfiles osgifx.jar -appclass aQute.launcher.pre.EmbeddedLauncher -name "OSGi.fx Console" -outdir deploy -outfile osgi-fx-console -v
        -   name: Build Linux Image (DEB)
            run : javapackager -deploy -native deb -srcfiles osgifx.jar -appclass aQute.launcher.pre.EmbeddedLauncher -name "OSGi.fx Console" -outdir deploy -outfile osgi-fx-console -v
        -   name: Build Windows Image (EXE)
            run : javapackager -deploy -native exe -srcfiles osgifx.jar -appclass aQute.launcher.pre.EmbeddedLauncher -name "OSGi.fx Console" -outdir deploy -outfile osgi-fx-console -v
